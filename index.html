<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metas 2026</title>
    <meta name="theme-color" content="#00ABE4">
    <link rel="manifest" href="manifest.json">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        bright: '#00ABE4',
                        bgLight: '#E9F1FA',
                        bgDark: '#0f172a', // Slate 900
                        cardDark: '#1e293b' // Slate 800
                    }
                }
            }
        }
    </script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* CSS Base */
        body { 
            font-family: 'Segoe UI', sans-serif; 
            user-select: none;
            overflow-x: hidden;
            padding-bottom: 120px;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Animações */
        .pop-in { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .slide-up { animation: slideUp 0.5s ease-out; }
        .float-text { animation: floatUpFade 1.2s ease-out forwards; }
        .pulse-soft { animation: pulseSoft 2s infinite; }

        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes floatUpFade {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            50% { transform: translateY(-30px) scale(1.1); opacity: 1; }
            100% { transform: translateY(-50px) scale(1); opacity: 0; }
        }
        @keyframes pulseSoft {
            0% { box-shadow: 0 0 0 0 rgba(0, 171, 228, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 171, 228, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 171, 228, 0); }
        }

        /* Utilitários Visuais */
        .text-bright { color: #00ABE4; }
        .bg-bright { background-color: #00ABE4; }
        
        /* Modal Backdrop */
        #nameModal { backdrop-filter: blur(8px); background-color: rgba(0,0,0, 0.6); }

        /* Barra Listrada Animada */
        .progress-striped {
            background-image: linear-gradient(45deg,rgba(255,255,255,.2) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.2) 50%,rgba(255,255,255,.2) 75%,transparent 75%,transparent);
            background-size: 1rem 1rem;
            animation: progress-bar-stripes 1s linear infinite;
        }
        @keyframes progress-bar-stripes { from { background-position: 1rem 0; } to { background-position: 0 0; } }
    </style>
</head>
<body class="bg-bgLight text-slate-700 dark:bg-bgDark dark:text-slate-200">

    <div id="nameModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-6">
        <div class="bg-white dark:bg-cardDark rounded-[2rem] shadow-2xl p-8 w-full max-w-sm text-center slide-up border border-[#E9F1FA] dark:border-slate-600">
            <div class="w-16 h-16 bg-[#E9F1FA] dark:bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-5">
                <i class="fas fa-user-astronaut text-bright text-2xl"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">Jornada 2026</h2>
            <p class="text-gray-500 dark:text-gray-300 mb-6 font-medium">Quem é o autor desta história?</p>
            <input type="text" id="nameInput" placeholder="Seu nome" class="w-full bg-[#E9F1FA] dark:bg-slate-900 dark:text-white rounded-xl px-4 py-3 text-center text-lg mb-4 outline-none focus:ring-2 focus:ring-[#00ABE4] text-bright font-bold placeholder-gray-400">
            <button onclick="saveName()" class="w-full bg-bright text-white font-bold py-3 rounded-xl shadow-lg hover:brightness-110 transition transform active:scale-95">Iniciar</button>
        </div>
    </div>

    <button onclick="toggleTheme()" class="fixed top-6 right-6 z-50 bg-white/20 backdrop-blur-md p-3 rounded-full shadow-lg text-white hover:bg-white/30 transition border border-white/20">
        <i id="themeIcon" class="fas fa-moon text-lg"></i>
    </button>

    <button id="installBtn" class="hidden fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-white dark:bg-cardDark text-bright px-6 py-4 rounded-full shadow-2xl z-50 font-bold flex items-center gap-3 border border-blue-100 dark:border-slate-700 hover:scale-105 transition pulse-soft">
        <i class="fas fa-download bg-blue-50 dark:bg-slate-900 p-2 rounded-full"></i> 
        <span>Instalar App</span>
    </button>

    <header class="bg-bright text-white pt-8 pb-12 px-6 rounded-b-[3rem] shadow-lg relative overflow-hidden transition-colors">
        <div class="max-w-md mx-auto relative z-10 flex justify-between items-end">
            <div>
                <p class="text-blue-100 text-sm font-medium mb-1">Bem-vindo, <span id="userNameDisplay">...</span></p>
                <h1 class="text-3xl font-bold tracking-tight">Metas 2026</h1>
                <p class="text-blue-50 text-xs mt-2 opacity-90 max-w-[200px]">"Pequenos avanços diários constroem grandes impérios."</p>
            </div>
            <div class="bg-white/20 backdrop-blur-md p-3 rounded-2xl border border-white/10 shadow-inner">
                <i class="fas fa-flag-checkered text-2xl text-white"></i>
            </div>
        </div>
        <i class="fas fa-rocket absolute -left-4 top-10 text-8xl text-white opacity-10 -rotate-12"></i>
    </header>

    <main class="max-w-md mx-auto px-5 -mt-8 relative z-20">
        
        <div class="bg-white dark:bg-cardDark rounded-[2rem] shadow-lg shadow-blue-100/50 dark:shadow-black/30 p-5 mb-8 slide-up transition-colors">
            <label class="text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-3 block tracking-wider">Nova Conquista</label>
            <div class="flex flex-col gap-4">
                <input type="text" id="goalInput" placeholder="Ex: Escrever Capítulo 1..." 
                    class="w-full text-lg border-b border-gray-200 dark:border-slate-600 pb-2 outline-none focus:border-[#00ABE4] transition-colors text-gray-800 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 bg-transparent font-medium">
                
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-3 bg-[#E9F1FA] dark:bg-slate-900 px-4 py-2 rounded-xl transition-colors">
                        <button onclick="changeSteps(-1)" class="text-bright w-6 h-6 font-bold text-lg hover:scale-110 transition">-</button>
                        <div class="text-center w-8">
                            <span id="stepCountDisplay" class="font-bold text-bright text-lg block leading-none">3</span>
                            <span class="text-[9px] text-gray-500 dark:text-gray-400 uppercase font-bold">Etapas</span>
                        </div>
                        <button onclick="changeSteps(1)" class="text-bright w-6 h-6 font-bold text-lg hover:scale-110 transition">+</button>
                    </div>

                    <button onclick="addGoal()" class="bg-bright text-white w-12 h-12 rounded-full shadow-lg hover:scale-105 active:scale-95 transition flex items-center justify-center">
                        <i class="fas fa-plus text-lg"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="goalsList" class="space-y-5"></div>

        <div id="emptyState" class="text-center py-12 hidden opacity-70">
            <i class="fas fa-clipboard-list text-4xl text-gray-400 dark:text-slate-600 mb-3"></i>
            <p class="text-gray-500 dark:text-slate-500 font-medium">Sua lista está pronta para ser escrita.</p>
        </div>
    </main>

    <footer class="text-center py-8 mt-auto relative z-10">
        <p class="text-gray-500 dark:text-gray-400 text-xs font-medium">
            Desenvolvido pelo <span class="text-bright font-bold">Profº Sérgio Araújo</span> &copy; 2026
        </p>
    </footer>

    <div id="floatContainer" class="fixed inset-0 pointer-events-none z-50"></div>

    <script>
        // --- Lógica de Tema ---
        function toggleTheme() {
            const html = document.documentElement;
            const icon = document.getElementById('themeIcon');
            
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                icon.className = 'fas fa-moon text-lg';
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                icon.className = 'fas fa-sun text-lg';
            }
        }

        if (localStorage.getItem('theme') === 'dark' || 
           (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            document.getElementById('themeIcon').className = 'fas fa-sun text-lg';
        }

        // --- Instalação PWA ---
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.classList.remove('hidden');
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    deferredPrompt = null;
                    installBtn.classList.add('hidden');
                }
            }
        });

        // --- Estado e Lógica ---
        const INCENTIVES = [
            "Excelente!", "Avanço confirmado!", "Continue assim!", 
            "Foco total!", "Mais um passo!", "Isso aí!", "Grande trabalho!"
        ];

        let state = {
            goals: JSON.parse(localStorage.getItem('goals_2026_final')) || [],
            name: localStorage.getItem('user_name_2026'),
            tempSteps: 3
        };

        // --- Inicialização ---
        function init() {
            // Verifica se tem nome. Se não tiver, mostra o modal.
            if (!state.name) {
                document.getElementById('nameModal').classList.remove('hidden');
            } else {
                document.getElementById('userNameDisplay').innerText = state.name;
            }
            render();
        }

        function saveName() {
            const val = document.getElementById('nameInput').value.trim();
            if(val) {
                state.name = val;
                localStorage.setItem('user_name_2026', val);
                document.getElementById('userNameDisplay').innerText = val;
                document.getElementById('nameModal').classList.add('hidden');
            }
        }

        function saveData() {
            localStorage.setItem('goals_2026_final', JSON.stringify(state.goals));
            render();
        }

        function changeSteps(delta) {
            let n = state.tempSteps + delta;
            if (n < 1) n = 1;
            if (n > 50) n = 50;
            state.tempSteps = n;
            document.getElementById('stepCountDisplay').innerText = n;
        }

        function addGoal() {
            const input = document.getElementById('goalInput');
            const text = input.value.trim();
            if (text) {
                state.goals.unshift({
                    text: text,
                    total: state.tempSteps,
                    current: 0,
                    done: false,
                    id: Date.now()
                });
                saveData();
                input.value = '';
                state.tempSteps = 3;
                document.getElementById('stepCountDisplay').innerText = 3;
            }
        }

        function advance(index, event) {
            if (event) event.stopPropagation();
            const goal = state.goals[index];
            if(goal.done) return;

            goal.current++;
            showFloatingText(event ? event.clientX : null, event ? event.clientY : null);

            if(goal.current >= goal.total) {
                goal.done = true;
                confetti({
                    particleCount: 150, spread: 80, origin: { y: 0.6 },
                    colors: ['#00ABE4', '#E9F1FA']
                });
            } else {
                confetti({
                    particleCount: 20, spread: 40, startVelocity: 25,
                    origin: { 
                        x: (event ? event.clientX : window.innerWidth/2) / window.innerWidth, 
                        y: (event ? event.clientY : window.innerHeight/2) / window.innerHeight 
                    },
                    colors: ['#00ABE4']
                });
            }
            saveData();
        }

        function deleteGoal(index) {
            if(confirm("Remover esta meta?")) {
                state.goals.splice(index, 1);
                saveData();
            }
        }

        function getStatus(current, total) {
            const pct = (current / total) * 100;
            if (pct === 0) return { text: "Ponto de Partida", color: "text-gray-500 dark:text-gray-400" };
            if (pct < 35) return { text: "Ganhando Impulso", color: "text-[#00ABE4]" };
            if (pct < 70) return { text: "Ritmo Forte", color: "text-blue-600 dark:text-blue-400" };
            if (pct < 100) return { text: "Reta Final", color: "text-indigo-600 dark:text-indigo-400" };
            return { text: "Conquistado", color: "text-emerald-600 dark:text-emerald-400 font-bold" };
        }

        function showFloatingText(x, y) {
            const container = document.getElementById('floatContainer');
            const el = document.createElement('div');
            el.innerText = INCENTIVES[Math.floor(Math.random() * INCENTIVES.length)];
            const finalX = x || window.innerWidth / 2;
            const finalY = y || window.innerHeight / 2;
            el.className = "float-text absolute bg-[#00ABE4] text-white font-bold px-4 py-2 rounded-full shadow-xl text-sm z-50 whitespace-nowrap";
            el.style.left = (finalX - 40) + 'px'; el.style.top = (finalY - 20) + 'px';
            container.appendChild(el);
            setTimeout(() => el.remove(), 1200);
        }

        function render() {
            const list = document.getElementById('goalsList');
            const empty = document.getElementById('emptyState');

            list.innerHTML = '';
            
            if (state.goals.length === 0) {
                empty.classList.remove('hidden');
            } else {
                empty.classList.add('hidden');
                state.goals.sort((a, b) => a.done - b.done);

                state.goals.forEach((goal, index) => {
                    const pct = Math.min(100, Math.round((goal.current / goal.total) * 100));
                    const status = getStatus(goal.current, goal.total);
                    const isDone = goal.done;

                    const item = document.createElement('div');
                    item.className = `pop-in bg-white dark:bg-cardDark rounded-[1.5rem] p-5 shadow-sm dark:shadow-black/20 border border-transparent transition-all duration-300 relative overflow-hidden ${isDone ? 'opacity-60 grayscale-[0.5] bg-gray-100 dark:bg-slate-900' : 'hover:shadow-md hover:border-blue-100 dark:hover:border-slate-600'}`;
                    
                    const btnHtml = isDone 
                        ? `<div class="w-12 h-12 rounded-full bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 flex items-center justify-center text-xl shadow-inner"><i class="fas fa-check"></i></div>`
                        : `<button onclick="advance(${index}, event)" class="w-12 h-12 rounded-full bg-bright text-white shadow-lg shadow-blue-300 dark:shadow-none flex items-center justify-center active:scale-90 transition group"><i class="fas fa-play ml-1 group-hover:scale-110 transition"></i></button>`;

                    item.innerHTML = `
                        <div class="flex items-center gap-4 relative z-10">
                            <div class="flex-shrink-0">
                                ${btnHtml}
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex justify-between items-start">
                                    <h3 class="text-gray-800 dark:text-white font-bold text-lg leading-tight truncate pr-2 ${isDone ? 'line-through decoration-gray-400 text-gray-500 dark:text-gray-500' : ''}">${goal.text}</h3>
                                    <button onclick="deleteGoal(${index})" class="text-gray-400 dark:text-slate-500 hover:text-red-500 p-1"><i class="fas fa-times"></i></button>
                                </div>
                                <div class="flex justify-between items-center text-xs mt-1 mb-2">
                                    <span class="${status.color} font-semibold uppercase tracking-wider">${status.text}</span>
                                    <span class="text-gray-600 dark:text-gray-300 font-medium bg-[#E9F1FA] dark:bg-slate-700 px-2 py-0.5 rounded-md">${goal.current}/${goal.total}</span>
                                </div>
                                <div class="h-3 w-full bg-[#E9F1FA] dark:bg-slate-700 rounded-full overflow-hidden shadow-inner">
                                    <div class="h-full bg-bright rounded-full transition-all duration-500 ${!isDone && pct > 0 ? 'progress-striped' : ''}" style="width: ${pct}%"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    list.appendChild(item);
                });
            }
        }

        if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
        init();
    </script>
</body>
</html>
